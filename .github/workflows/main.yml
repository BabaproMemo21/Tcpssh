name: SSH via Localtonet

on:
  workflow_dispatch:
    inputs:
      AUTH_TOKEN:
        description: 'Localtonet AUTH_TOKEN'
        required: true

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: SSH anahtarÄ± oluÅŸtur
        run: |
          ssh-keygen -t ed25519 -f id_ed25519 -N ""
          echo "ğŸ”‘ Public Key:"
          cat id_ed25519.pub

      - name: Localtonet indir ve Ã§alÄ±ÅŸtÄ±r
        run: |
          wget https://github.com/localtonet/cli/releases/latest/download/localtonet-linux-x64 -O lt
          chmod +x lt
          nohup ./lt tcp --token "${{ github.event.inputs.AUTH_TOKEN }}" --port 22 > tunnel.log 2>&1 &
          sleep 10  # baÄŸlantÄ±nÄ±n oturmasÄ± iÃ§in bekle

      - name: TÃ¼nel Linkini ve SSH komutunu gÃ¶ster
        run: |
          echo "ğŸŒ Localtonet Link:"
          cat tunnel.log | grep -Eo 'tcp://[^\s]+' || echo "âŒ Link bulunamadÄ±"
          echo "ğŸ” SSH Ã–zel Anahtar:"
          cat id_ed25519
          echo "ğŸ“¦ SSH BaÄŸlantÄ± Komutu:"
          LINK=$(grep -Eo 'tcp://[^\s]+' tunnel.log | head -n1)
          HOST=$(echo $LINK | cut -d'/' -f3 | cut -d':' -f1)
          PORT=$(echo $LINK | cut -d':' -f3)
          echo "ssh -i id_ed25519 -o StrictHostKeyChecking=no -p $PORT ubuntu@$HOST"
